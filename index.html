<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricelist Aplikasi Premium - Steotype</title>
    
    <meta property="og:title" content="Pricelist Aplikasi Premium - Steotype">
    <meta property="og:description" content="Daftar harga terbaru aplikasi premium untuk Steotype. Cepat dan mudah diakses.">
    <meta property="og:image" content="https://raw.githubusercontent.com/steotype/steotype/efbd7ff352eb54b06abc5ba0cc4cce74056b4099/lipe.png">
    <meta property="og:url" content="https://steotype.pages.dev">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Pricelist Aplikasi Premium - Steotype">
    <meta name="twitter:description" content="Daftar harga terbaru aplikasi premium untuk Steotype. Cepat dan mudah diakses.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/steotype/steotype/efbd7ff352eb54b06abc5ba0cc4cce74056b4099/lipe.png">
    <meta name="twitter:url" content="https://steotype.pages.dev">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #ffe6f0, #fff0f6, #fff8fb);
            color: #4a4a4a;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            animation: fadeIn 1.2s ease;
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        .header h1 {
            font-size: 2.8rem;
            color: #ff6fa9;
            text-shadow: 2px 2px #ffd6e6;
            animation: floatY 3s ease-in-out infinite;
        }
        .header p {
            margin-top: 5px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #ff9ed0;
            letter-spacing: 1px;
        }

        /* SEARCH BAR */
        .search-bar {
            margin-bottom: 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            animation: fadeUp 1.2s ease;
        }
        .search-bar input {
            width: 80%;
            max-width: 500px;
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid #ffc1da;
            font-size: 1rem;
            background-color: #fff7fb;
            box-shadow: 0 3px 6px rgba(255, 182, 206, 0.3);
            outline: none;
            transition: all 0.3s ease;
        }
        .search-bar input:focus {
            border-color: #ff89bb;
            box-shadow: 0 4px 12px rgba(255, 150, 200, 0.5);
        }

        .download-all-button {
            width: 80%;
            max-width: 500px;
        }
        .download-all-button button {
            width: 100%;
            padding: 12px 0;
            background: linear-gradient(90deg, #ff89bb, #ffa8d1);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 4px 8px rgba(255, 100, 150, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .download-all-button button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(255, 100, 150, 0.6);
        }

        /* GRID */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            animation: fadeUp 1s ease;
        }

        /* CARD */
        .card {
            background-color: #fff;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(255, 140, 180, 0.2);
            transition: all 0.4s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            transform: scale(1);
            animation: popIn 0.8s ease;
        }
        .card:hover {
            transform: translateY(-8px) rotate(-1deg);
            box-shadow: 0 8px 16px rgba(255, 120, 160, 0.4);
        }
        .card-header {
            text-align: center;
            margin-bottom: 15px;
        }
        .card-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff5c9a;
            text-shadow: 1px 1px #ffd0e0;
        }
        .card-body ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .card-body li {
            padding: 8px 0;
            border-bottom: 1px dashed #ffe0ed;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .card-body li:hover {
            background-color: #fff5fa;
            border-radius: 8px;
            padding-left: 10px;
        }
        .subtitle {
            font-weight: 600;
            color: #ff80b5;
            margin-top: 10px;
        }
        .price {
            font-weight: bold;
            color: #ff6fa9;
        }

        /* BUTTON */
        .download-button {
            display: block;
            width: 100%;
            padding: 10px 0;
            margin-top: 20px;
            background: linear-gradient(90deg, #ff89bb, #ffa8d1);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 3px 8px rgba(255, 120, 160, 0.4);
            transition: all 0.3s ease;
        }
        .download-button:hover {
            transform: scale(1.05);
            background: linear-gradient(90deg, #ff76b0, #ff9fc7);
            box-shadow: 0 6px 12px rgba(255, 100, 150, 0.6);
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes fadeUp {
            from {opacity: 0; transform: translateY(30px);}
            to {opacity: 1; transform: translateY(0);}
        }
        @keyframes floatY {
            0%, 100% {transform: translateY(0);}
            50% {transform: translateY(-8px);}
        }
        @keyframes popIn {
            0% {opacity: 0; transform: scale(0.95);}
            100% {opacity: 1; transform: scale(1);}
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="header">
        <h1>Pricelist Aplikasi Premium</h1>
        <p>Steotype</p>
    </div>

    <div class="search-bar">
        <input type="text" id="searchInput" onkeyup="searchCards()" placeholder="Cari aplikasi...">
        
        <div class="download-all-button">
            <button onclick="downloadAllCards()">Klik Disini untuk Mengunduh Semua Pricelist</button>
        </div>
    </div>

    <div class="grid-container" id="pricelistGrid">
    </div>
</div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
    const csvUrl = 'https://raw.githubusercontent.com/steotype/steotype/4f1dcc116f865734090afeee42be5ffbf55bd22c/pricelist.csv'; 
    const fullPricelistImageUrl = 'https://raw.githubusercontent.com/steotype/steotype/dc79d8469c35124778febc04db0e573fa48f069f/PL-New.png';

    async function fetchAndRenderData() {
        try {
            const noCacheUrl = `${csvUrl}?t=${new Date().getTime()}`;
            const response = await fetch(noCacheUrl);
            if (!response.ok) {
                document.getElementById('pricelistGrid').innerHTML = '<p style="text-align:center;">‚ùå Gagal memuat data.</p>';
                throw new Error('Network error');
            }
            const csvText = await response.text();
            const pricelistData = parseCsv(csvText);
            loadDataAndRenderCards(pricelistData);
        } catch (error) {
            console.error(error);
        }
    }

    function parseCsv(csvString) {
        const lines = csvString.trim().split('\n').filter(line => line.trim() !== '');
        if (lines.length === 0) return [];
        const headers = lines[0].split(',');
        const data = [];
        for (let i = 1; i < lines.length; i++) {
            const currentLine = lines[i].split(',');
            if (currentLine.length === headers.length) {
                const row = {};
                for (let j = 0; j < headers.length; j++) {
                    row[headers[j].trim()] = currentLine[j].trim();
                }
                data.push(row);
            }
        }
        return data;
    }

    function loadDataAndRenderCards(pricelistData) {
        const groupedData = groupDataByApp(pricelistData);
        const gridContainer = document.getElementById('pricelistGrid');
        gridContainer.innerHTML = '';
        for (const appName in groupedData) {
            const card = createCard(appName, groupedData[appName]);
            gridContainer.appendChild(card);
        }
    }

    function groupDataByApp(data) {
        const grouped = {};
        data.forEach(item => {
            const appName = item.app_name;
            if (!grouped[appName]) grouped[appName] = [];
            grouped[appName].push(item);
        });
        return grouped;
    }

    function createCard(appName, prices) {
        const card = document.createElement('div');
        const cardId = 'card-' + appName.replace(/[^a-zA-Z0-9]/g, '-');
        card.className = 'card';
        card.id = cardId;
        card.setAttribute('data-app-name', appName);

        const headerDiv = document.createElement('div');
        headerDiv.className = 'card-header';
        const h2 = document.createElement('h2');
        h2.textContent = appName.toUpperCase();
        headerDiv.appendChild(h2);
        card.appendChild(headerDiv);

        const bodyDiv = document.createElement('div');
        bodyDiv.className = 'card-body';
        const ul = document.createElement('ul');

        const groupedPrices = {};
        prices.forEach(price => {
            const category = price.category;
            if (!groupedPrices[category]) groupedPrices[category] = [];
            groupedPrices[category].push(price);
        });

        for (const category in groupedPrices) {
            const priceItems = groupedPrices[category];
            if (category) {
                const subtitle = document.createElement('li');
                subtitle.className = 'subtitle';
                subtitle.textContent = category;
                ul.appendChild(subtitle);
            }
            priceItems.forEach(price => {
                const li = document.createElement('li');
                li.textContent = price.duration;
                const priceSpan = document.createElement('span');
                priceSpan.className = 'price';
                priceSpan.textContent = price.price;
                if (price.notes) priceSpan.textContent += ' ' + price.notes;
                li.appendChild(priceSpan);
                ul.appendChild(li);
            });
        }

        bodyDiv.appendChild(ul);
        card.appendChild(bodyDiv);

        const downloadButton = document.createElement('button');
        downloadButton.className = 'download-button';
        downloadButton.textContent = 'Unduh';
        downloadButton.onclick = () => downloadCard(cardId);
        card.appendChild(downloadButton);

        return card;
    }

    function searchCards() {
        const input = document.getElementById('searchInput').value.toUpperCase();
        const cards = document.getElementsByClassName('card');
        for (let i = 0; i < cards.length; i++) {
            const h2 = cards[i].querySelector('h2');
            cards[i].style.display = h2 && h2.textContent.toUpperCase().includes(input) ? "" : "none";
        }
    }

    function downloadCard(cardId) {
        const card = document.getElementById(cardId);
        const btn = card.querySelector('.download-button');
        btn.style.display = 'none';
        html2canvas(card, { scale: 2 }).then(canvas => {
            const appName = card.getAttribute('data-app-name');
            const link = document.createElement('a');
            link.download = `${appName.toLowerCase().replace(/[^a-zA-Z0-9]/g, '-')}-pricelist.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            btn.style.display = 'block';
        });
    }

    function downloadAllCards() {
        const link = document.createElement('a');
        link.href = fullPricelistImageUrl; 
        link.download = 'All_PL.png';
        link.target = '_blank';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    window.onload = fetchAndRenderData;
</script>

</body>
</html>
